<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CipherCircle</title>

<style>
:root{
  --bg:#020617;
  --panel:#0f172a;
  --text:#e5e7eb;
  --muted:#94a3b8;
  --accent:#38bdf8;
  --border:#1e293b;
  --success:#22c55e;
  --error:#ef4444;
}

*{box-sizing:border-box}

body{
  margin:0;
  padding:16px;
  font-family:system-ui,sans-serif;
  background:radial-gradient(circle at top,#0b122f,var(--bg) 70%);
  color:var(--text);
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
}

.container{
  position:relative;
  max-width:520px;
  margin:auto;
  padding:16px;
  background:var(--panel);
  border-radius:14px;
  box-shadow:0 0 40px rgba(255,255,255,0.03), 0 0 80px rgba(255,255,255,0.02);
}

/* BORDA ANIMADA (APENAS BORDA) */
.container::before{
  content:"";
  position:absolute;
  inset:0;
  padding:1.5px;
  border-radius:14px;
  background:linear-gradient(
    90deg,
    transparent,
    var(--accent),
    #ffffff,
    var(--accent),
    transparent
  );
  background-size:300% 300%;
  animation:borderFlow 14s linear infinite;
  -webkit-mask:
    linear-gradient(#fff 0 0) content-box,
    linear-gradient(#fff 0 0);
  -webkit-mask-composite:xor;
          mask-composite:exclude;
  pointer-events:none;
}

.container.active::before{animation-duration:3s}
.container.success::before{
  background:linear-gradient(90deg,transparent,var(--success),transparent);
}
.container.error::before{
  background:linear-gradient(90deg,transparent,var(--error),transparent);
}

@keyframes borderFlow{
  from{background-position:0% 50%}
  to{background-position:300% 50%}
}

h1{
  text-align:center;
  font-size:18px;
  letter-spacing:2px;
  color:var(--accent);
  margin:0 0 16px 0;
}

input,textarea,button{
  width:100%;
  margin-top:10px;
  padding:12px;
  border-radius:10px;
  border:1px solid var(--border);
  background:#020617;
  color:var(--text);
  text-align:center;
  font-size:15px;
}

textarea{
  height:120px;
  resize:none;
  text-align:left;
}

button{
  border:none;
  background:linear-gradient(135deg,#0ea5e9,#2563eb);
  font-weight:600;
  cursor:pointer;
  transition:opacity 0.2s;
}

button:active{
  opacity:0.8;
}

.secondary{
  background:transparent;
  border:1px solid var(--accent);
  color:var(--accent);
}

.footer{
  text-align:center;
  font-size:11px;
  color:var(--muted);
  margin-top:12px;
}
</style>
</head>

<body>

<div class="container" id="container">
  <h1>CIPHER CIRCLE</h1>

  <input id="chave" type="text" placeholder="Digite ou cole a chave secreta" autocomplete="off">

  <textarea id="entrada" placeholder="Digite ou cole o texto"></textarea>

  <button onclick="codificar()">Codificar</button>
  <button onclick="decodificar()">Decodificar</button>
  <button onclick="colar()">Colar</button>
  <button onclick="copiar()">Copiar</button>
  <button class="secondary" onclick="limpar()">Apagar tudo</button>

  <textarea id="saida" placeholder="Digite ou cole o resultado" readonly></textarea>

  <div class="footer">criptografia</div>
</div>

<script>
const base = "abcdefghijklmnopqrstuvwxyzáàâãéêíóôõúçABCDEFGHIJKLMNOPQRSTUVWXYZÁÀÂÃÉÊÍÓÔÕÚÇ0123456789 .,!?;:";
const simbolos = "@#$&+_-()=*%¨/\\[]{}";
const container = document.getElementById("container");
const chave = document.getElementById("chave");
const entrada = document.getElementById("entrada");
const saida = document.getElementById("saida");

function efeito(tipo){
  container.classList.add(tipo);
  setTimeout(()=>container.classList.remove(tipo),600);
}

/* CRIPTOGRAFIA ESTÁVEL E REVERSÍVEL */
function gerarMapas(chaveTexto){
  let seed = 0;
  for (let c of chaveTexto) seed += c.charCodeAt(0);

  // Criar alfabeto embaralhado
  let destino = base.split("");
  
  // Embaralhar usando a seed da chave
  for (let i = destino.length - 1; i > 0; i--) {
    seed = (seed * 9301 + 49297) % 233280;
    const j = seed % (i + 1);
    [destino[i], destino[j]] = [destino[j], destino[i]];
  }

  // Criar mapas de codificação e decodificação
  let mapa = {};
  let inverso = {};
  
  for (let i = 0; i < base.length; i++) {
    mapa[base[i]] = destino[i];
    inverso[destino[i]] = base[i];
  }

  return { mapa, inverso };
}

/* DETECÇÃO AUTOMÁTICA SE É TEXTO CODIFICADO OU NORMAL */
function pareceCodificado(texto){
  // Verifica se tem muitos caracteres embaralhados
  const caracteresOriginais = texto.split('').filter(c => base.includes(c)).length;
  const total = texto.length;
  
  // Se menos de 70% dos caracteres estão no alfabeto base, provavelmente está codificado
  return caracteresOriginais / total < 0.7;
}

function codificar(){
  const chaveVal = chave.value.trim();
  const entradaVal = entrada.value;
  
  if (!chaveVal){ 
    efeito("error");
    alert("Digite uma chave secreta!");
    return;
  }
  
  if (!entradaVal.trim()){
    efeito("error");
    return;
  }

  const { mapa } = gerarMapas(chaveVal);
  
  // CODIFICAR
  saida.value = [...entradaVal].map(c => mapa[c] || c).join("");
  efeito("active");
}

function decodificar(){
  const chaveVal = chave.value.trim();
  const entradaVal = entrada.value;
  
  if (!chaveVal){ 
    efeito("error");
    alert("Digite uma chave secreta!");
    return;
  }
  
  if (!entradaVal.trim()){
    efeito("error");
    return;
  }

  const { inverso } = gerarMapas(chaveVal);
  
  // DECODIFICAR
  saida.value = [...entradaVal].map(c => inverso[c] || c).join("");
  efeito("active");
}

async function colar(){
  try{
    const texto = await navigator.clipboard.readText();
    entrada.value = texto;
    efeito("active");
  }catch(err){
    efeito("error");
    alert("Não foi possível colar. Permita o acesso à área de transferência.");
  }
}

async function copiar(){
  if (!saida.value.trim()){
    efeito("error");
    return;
  }
  
  try{
    await navigator.clipboard.writeText(saida.value);
    entrada.value = "";
    saida.value = "";
    efeito("success");
  }catch(err){
    efeito("error");
    alert("Não foi possível copiar.");
  }
}

function limpar(){
  entrada.value = "";
  saida.value = "";
}

// Permitir Enter para processar
entrada.addEventListener('keydown', (e) => {
  if (e.key === 'Enter' && e.ctrlKey) {
    codificar();
  }
});

chave.addEventListener('keydown', (e) => {
  if (e.key === 'Enter') {
    entrada.focus();
  }
});
</script>

</body>
</html>
